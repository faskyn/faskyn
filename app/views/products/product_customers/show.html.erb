<% provide(:title, @product.name + " customer") %>
<div class= "container-fluid product-container">
  <div class="product-customer-lead-container">

    <% @product_customer.group_invitations.pending_user(current_user).each do |group_invitation| %>

      <div class="well product-well" id="product-invitation-well">
        <div class="row pending-product-invitation-row">
          <div class="col-md-12">
            <h4>You have a pending invitation to join this customer case as a referencer.</h4>
            <p>By joining you will be able to verify that you are using the product. You will also be able to write a review to help the product become more compelling.</p>
          </div>
        </div>
        <div class="row" style="text-align:center;">
          <div class="col-md-12">
            <%= link_to "Accept Invitation", accept_group_invitation_path(group_invitation), method: :patch, class: "btn btn-primary" %>
            <%= link_to "Decline Invitation", group_invitation_path(group_invitation), method: :delete, class: "btn btn-danger delete-invitation-button" %>
          </div>
        </div>
      </div>

    <% end %>

    <% cache [@product_customer, @product_customer.owner.profile] do %>

      <div class="panel panel-default product-panel" data-behavior="commentable_<%= @product_customer.id %>">

        <div class="panel-heading">
          <%= link_to @product do %>
            <div class= "product-header">
              <%= image_tag @product.product_image_url(:small_thumb) %>
              <h4><%= @product.name %>
              's customer case</h4>
            </div>
          <% end %>
        </div>

        <div class="panel-body">
          <div class="row">
            <div class="col-md-12">
              <div class="product-list">
                <div class="list-name">
                  <%= link_to @product_customer.website, target: "_blank" do %>
                    <h4><%= @product_customer.customer %></h4>
                  <% end %>
                </div>
                <div class="description">
                  <%= @product_customer.usage %>
                </div>            
              </div>
            </div>
          </div>
        </div>

      </div>

    <% end %>

    <div class="panel panel-default" id="comment-panel">
      <div class="panel-heading">
        <div class = "row comment-form-row">
          <div class="col-md-12">
            <div class="row">
              <div class="col-md-12">
                <div class="col-md-12">
                  <%= render partial: 'comments/form', locals: { commentable: @product_customer } %>
                </div>
              </div>
            </div>
          </div>
        </div>
        <% if @comments.size > 3 %>
          <div class="row open-all-comments-row" data-behavior="open-all-comments-row">
            <div class="col-md-12">
              <div class="col-md-12">
                <a class="open-all-comments" data-commentableid="<%= @product_lead.id %>" data-behavior="open-all-comments">Show all</a>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class="panel-body">
        <div class = "row">
          <div class="col-md-12" data-behavior="comment-insert-<%= @product_customer.id%>">
            <% cache ['comments-index-customer', @comments.map(&:id), @comments.map(&:updated_at).max, @comments.map{ |comment| comment.user.profile.updated_at }.max] do %>

               <%= render partial: "comments/comment", collection: @comments %>

            <% end %>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>