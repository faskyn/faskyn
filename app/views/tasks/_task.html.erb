<% cache(['index-single-task', task, task.assigner_profile, task.executor_profile]) do %>
  <% if current_user.id == task.assigner.id %>
    <tr id="task_<%= task.id %>">
      <td class = "col-md-3">
        <div class="row" style="display: table;width: 100%;">
          <div class = "col-md-3" style="vertical-align:middle;display:table-cell;float:none;">
              <i class="fa fa-sign-out" style="color:#007cc3;"></i>
          </div>
          <div class = "col-md-9" style="padding-left:0px;width:100%;float:left;text-align:left">
            <%= link_to user_path(id: task.executor.id) do %>
              <div class="table-user-name">
                <%= task.executor.full_name %>
              </div>
              <div class="table-company-name">
                <%= task.executor.company %>
              </div>
            <% end %>
          </div>
        </div>
      </td>
  <% else %>
    <tr id="task_<%= task.id %>">
      <td class = "col-md-3">
        <div class="row" style="display: table;width: 100%;">
          <div class = "col-md-3" style="vertical-align:middle;display:table-cell;float:none;">
              <i class="fa fa-sign-in"></i>
          </div>
          <div class = "col-md-9" style="padding-left:0px;width:100%;float:left;text-align:left">
            <%= link_to user_path(id: task.assigner.id) do %>
              <div class="table-user-name">
                <%= task.assigner.full_name %>
              </div>
              <div class="table-company-name">
                <%= task.assigner.company %>
              </div>
            <% end %>
          </div>
        </div>
      </td>
  <% end %>

    <td class="cold-md-6">
      <%= task.content %>
    </td>
    <td class="col-md-2">
      <% if task.completed? %>
        <%= local_time(task.completed_at, "%d %b %I%p") %>
      <% else %>
        <% unless task.deadline == nil %>
         <%= local_time(task.deadline, "%d %b %I%p") %>
        <% end %>
      <% end %>
    </td>

    <td class="col-md-1">
      <div class="dropdown">
        <a data-target="task-change-<%= task.id %>" id="task-change-<%= task.id %>" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
          <i class="fa fa-ellipsis-v fa-lg" style="padding: 10px 20px 10px 20px;"></i>
        </a>
        <ul class = "dropdown-menu dropdown-menu-right" aria-labelledby="task-change-<%= task.id %>">
          <li>
          <% if task.completed_at == nil %>
            <%= link_to "Complete Task", complete_user_task_path(id: task.id), action: :complete, remote: true, method: :patch %>
          <% else %>
            <%= link_to "Uncomplete Task", uncomplete_user_task_path(id: task.id), action: :uncomplete, remote: true, method: :patch %>
          <% end %>
          </li>
          <li>
            <%= link_to "Edit Task", edit_user_task_path(id: task.id), remote: true, type: "button", 'data-toggle' => "modal", 'data-target' => "#updatetask_#{task.id}" %>
          </li>
          <li>
            <%= link_to "Delete Task", user_task_path(id: task.id), remote: true , type: "button", 'data-toggle' => "modal", 'data-target' => "#deletetask_#{task.id}" %>

          </li>
        </ul>
      </div>

     <!--Modal for updating task -->
            
      <div class="modal fade updatetask" id="updatetask_<%= task.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content" style="text-align:left">
            <%= form_for([@user, task], method: :patch, remote: true, html: { class: "task_form_#{task.id}"}) do |f| %>
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Edit Task</h4>
              </div>
              <div class="modal-body">
                <div class="alert alert-danger" style="display:none">
                  <ul class="errors" style="display:none">
                    <%= render 'layouts/error_messages', object: f.object %>
                  </ul>
                </div>
                <div class="field form-group">
                  <% if current_user.id == task.assigner.id %>
                    <p><strong>Executor: <%= task.executor.full_name %>, <%= task.executor.company %></strong></p>
                  <% else %>
                    <p><strong>Assigner: <%= task.assigner.full_name %>, <%= task.assigner.company %></strong></p>
                  <% end %>
                </div>
                <div class="field form-group">
                  <%= f.label :content %>
                  <%= f.text_area :content, class: "form-control edit-content" %>
                </div>
                <div class="field form-group">
                  <%= f.label :deadline %>
                  <%= f.text_field :deadline_string, class: "form-control edit-task-deadline" %>
                </div>    
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="updatetaskclose">Close</button>
                  <%= f.button "Update task", class: 'btn btn-primary edit-task-submit', data: {taskid: "#{task.id}", sid: current_user.id, disable_with: "<i class='fa fa-spinner fa-spin'></i> Saving..."} %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
            
      <!--Modal end for update task -->

      <!--Modal for delete task -->
            
      <div class="modal fade" id="deletetask_<%= task.id %>" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
          <div class="modal-content" style="text-align:left">
            <%= form_for([@user, task], method: :delete, remote: true) do |f| %>
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Delete Task</h4>
              </div>
              <div class="modal-body">
                <h4>Are you sure?</h4>
                <p> </p>  
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" id="deletetaskclose">Close</button>
                  <%= f.submit "Delete Task", class: 'btn btn-danger' %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    
    <!--Modal end for delete task -->

    </td>  
  </tr>

<% end %>





           
